<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link id="favicon" rel="shortcut icon" type="image/png" href="data:image/png;base64,....==" />
    <title>FreeCycle</title>

    <style> 
      /* styles here */
      form {
        padding: 10px;
        border: 2px solid black;
        border-radius: 5px;
      }
      input {
        padding: 4px 8px;
        margin: 4px;
      }
      span {
        font-size: 18px;
        margin: 4px;
        font-weight: 500;
      }
      .submit {
        font-size: 15px;
        color: rgb(8, 8, 8);
        background: rgb(228, 5, 5);
        padding: 6px 12px;
        border: none;
        margin-top: 8px;
        cursor: pointer;
        border-radius: 5px;
      }
    </style>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
        <!-- html here -->
  <h1>FreeCycle</h1> 
  <div id="app">

    <h2>New Item</h2>

    <form @submit.prevent="create_item">
      <span>UserName</span><br>
      <input
      v-model = "item.user_id"
      name="user_id"
      type="text"
      placeholder="user_id"
      /><br>
      <span>Latitude</span><br>
      <input
      v-model = "item.lat"
      name="lat"
      type="text"
      placeholder="lat"
      /><br>
      <span>Longitude</span><br>
      <input
      v-model = "item.lon"
      name="lon"
      type="text"
      placeholder="lon"
      /><br>
      <span>Image</span><br>
      <input
      v-model = "item.image"
      name="image"
      type="url"
      placeholder="url"
      /><br>
      <span>Keywords</span><br>
      <input
      v-model = "item.keywords"
      name="keywords"
      type="text"
      placeholder="keywords"
      /><br>
      <span>Description</span><br>
      <textarea 
      v-model = "description"
      name="description"
      placeholder="description"
      ></textarea
      /><br>
      <button data-action="create_item">Submit</button>
    </form>

    <h2>Items</h2>
    <ul>
       <li v-for="item in items">
        <span data-field="id">{{item.id}}</span>
        <span data-field="user_id">{{ item.user_id }}</span>
        <span data-field="Latitude">{{ item.lat }}</span>
        <span data-field="Longitude">{{ item.lon }}</span>
        <img :src="item.image" alt="image">
        <span data-field="Date">{{item.date_from}}</span>
        <span data-field="keywords">{{item.keywords}}</span>
        <span data-field="description">{{item.description}}</span>
				<button data-action="delete" @click="delete_item(item.id)">Delete</button>
        </li>
      </ul>
      
  </div>

<script type="module">
// javascript here
const {createApp} = Vue
const DEFAULT_API = '/api/v1';  // default to current http(s)://currentHost:currentPort/api/v1'
const urlParams = new URLSearchParams(window.location.search);
const urlAPI = (urlParams.get('api') || DEFAULT_API).replace(/\/$/, '');// Get api url (and remove trailing slash if present)

createApp ({
  data() {
    return {
      item: {
        id:'',
        user_id:'',
        keywords:'',
        description:'',
        image:'',
        lat:'',
        lon:'',
        date_from:'',
        date_to:'',
      },
      items:[],
    }
  },
  created(){
    this.clear_item()
    this.get_items()
  },
  methods:{
    get_items() {
      fetch(`${urlAPI}/items`, {
        method: 'GET',
      })
      .then(response => response.json())
      .then(json => this.items = json)// save the json we got back into the variable `items`
      .catch(err => console.error(err))
    },
    clear_item() {
      this.item = {...this.item, ...{
        user_id:'',
        keywords:'',
        description:'',
        image:'',
        lat:'',
        lon:'',
      }}
    },
    create_item() {
      fetch(`${urlAPI}/item`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(this.item),
    })
      .then(response => response.json())
      .then(json => console.log('create_item()', json))
      .then(this.clear_item)
      .then(this.get_items)
    .catch(err => console.error(err));
  },
  deleteItem(id) {
    fetch(`${urlAPI}/item/${id}`, {
        method: 'DELETE',
    })
    .then(json => console.log('delete_item()', json))
    .then(this.get_items)
      .catch(err => console.error(err));
  }
  },
}).mount('#app')

</script>
 
</body>
</html>